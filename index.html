<!doctype html>

<html lang="id">
<head>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.0/dist/jszip.min.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stego-Web — Simple (Vanilla JS)</title>
  <style>
    :root{--bg:#f7f8fb;--card:#ffffff;--muted:#6b7280;--accent:#0f172a}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:var(--bg); margin:0; padding:28px; color:var(--accent)}
    .container{max-width:980px;margin:0 auto}
    .card{background:var(--card);border-radius:12px;padding:20px;box-shadow:0 8px 24px rgba(15,23,42,0.06)}
    h1{margin:0 0 8px 0;font-size:20px}
    p.lead{margin:0 0 16px 0;color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    label{display:block;margin-bottom:10px}
    input[type=file]{width:100%}
    .preview{border-radius:8px;border:1px solid #e6e9ef;background:#fff; height:220px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .preview img{max-width:100%;max-height:100%;object-fit:contain}
    .meta{font-size:13px;color:var(--muted);margin-top:8px}
    .row{display:flex;gap:8px}
    button{background:#0f172a;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.secondary{background:#fff;color:var(--accent);border:1px solid #e6e9ef}
    .note{font-size:13px;color:var(--muted);margin-top:10px}
    .small{font-size:12px;color:var(--muted)}
    .actions{margin-top:12px}
    .link{color:#0b63ff;text-decoration:underline;cursor:pointer}
    footer{margin-top:14px;font-size:12px;color:var(--muted)}
    .inline{display:inline-flex;align-items:center;gap:8px}
    input[type=checkbox]{transform:scale(1.06)}
    .status{margin-top:8px;font-size:13px}
    .danger{color:#b91c1c}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Stego-Web — Simple (Vanilla JS)</h1>
      <p class="lead">Alat edukasi: gabungkan file rahasia ke dalam gambar cover. Semua proses berjalan di browser (tidak diupload ke server).</p><div class="grid">
    <div>
      <label>
        <strong>Cover (gambar yang terlihat)</strong>
        <input id="cover" type="file" accept="image/*" />
        <div class="small">Direkomendasikan: PNG atau BMP. JPEG bisa dipakai tapi kompresi mungkin mengganggu jika ingin operasi steganografi lanjutan.</div>
      </label>

      <label>
        <strong>File yang disembunyikan</strong>
        <input id="secret" type="file" />
        <div class="small">Bisa gambar, dokumen, atau file lain. Centang "Zip secret" bila ingin menggabungkan banyak file atau meminimalkan ukuran.</div>
      </label>

      <label class="inline">
        <input id="zip" type="checkbox" checked />
        <span class="small">Zip secret sebelum embed (memerlukan JSZip CDN)</span>
      </label>

      <div class="actions">
        <button id="mergeBtn">Gabungkan</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>

      <div class="status" id="status"></div>

      <div id="downloadArea" style="margin-top:12px"></div>

      <div class="note">
        Tips: jika hasilnya disimpan sebagai <code>hidden.png</code> lalu kamu ubah ekstensi menjadi <code>.zip</code>, kamu bisa mencoba mengekstrak file rahasia (jika dikompres ke ZIP).
      </div>

      <div class="note danger">Peringatan: Ini <strong>bukan</strong> enkripsi — hanya teknik embedding. Jangan gunakan untuk menyimpan data sangat sensitif.</div>
    </div>

    <div>
      <div class="card" style="padding:12px">
        <div class="preview" id="coverPreview">Preview cover</div>
        <div class="meta" id="coverMeta"></div>
      </div>

      <div style="height:12px"></div>

      <div class="card" style="padding:12px">
        <div class="preview" id="secretPreview">Preview secret (jika image)</div>
        <div class="meta" id="secretMeta"></div>
      </div>
    </div>
  </div>

  <footer>
    Cara pakai singkat: pilih cover + secret → klik "Gabungkan" → klik tombol download. Semua diproses lokal di browser.
  </footer>
</div>

  </div>  <!-- JSZip (CDN) untuk opsi ZIP; fallback: jika tidak ingin zip, uncheck kotak -->  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.0/dist/jszip.min.js"></script>  <script>
    const coverInput = document.getElementById('cover');
    const secretInput = document.getElementById('secret');
    const zipCheckbox = document.getElementById('zip');
    const mergeBtn = document.getElementById('mergeBtn');
    const resetBtn = document.getElementById('resetBtn');
    const statusEl = document.getElementById('status');
    const downloadArea = document.getElementById('downloadArea');

    const coverPreview = document.getElementById('coverPreview');
    const secretPreview = document.getElementById('secretPreview');
    const coverMeta = document.getElementById('coverMeta');
    const secretMeta = document.getElementById('secretMeta');

    let coverFile = null;
    let secretFile = null;

    function resetAll(){
      coverInput.value = '';
      secretInput.value = '';
      zipCheckbox.checked = true;
      statusEl.textContent = '';
      downloadArea.innerHTML = '';
      coverPreview.innerHTML = 'Preview cover';
      secretPreview.innerHTML = 'Preview secret (jika image)';
      coverMeta.textContent = '';
      secretMeta.textContent = '';
      coverFile = secretFile = null;
    }

    coverInput.addEventListener('change', (e) => {
      coverFile = e.target.files[0] || null;
      downloadArea.innerHTML = '';
      statusEl.textContent = '';
      if (coverFile){
        coverMeta.textContent = `${coverFile.name} • ${Math.round(coverFile.size/1024)} KB`;
        if (coverFile.type.startsWith('image/')){
          const img = document.createElement('img');
          img.src = URL.createObjectURL(coverFile);
          img.onload = () => URL.revokeObjectURL(img.src);
          coverPreview.innerHTML = '';
          coverPreview.appendChild(img);
        }
      } else {
        coverMeta.textContent = '';
        coverPreview.innerHTML = 'Preview cover';
      }
    });

    secretInput.addEventListener('change', (e) => {
      secretFile = e.target.files[0] || null;
      downloadArea.innerHTML = '';
      statusEl.textContent = '';
      if (secretFile){
        secretMeta.textContent = `${secretFile.name} • ${Math.round(secretFile.size/1024)} KB`;
        if (secretFile.type.startsWith('image/')){
          const img = document.createElement('img');
          img.src = URL.createObjectURL(secretFile);
          img.onload = () => URL.revokeObjectURL(img.src);
          secretPreview.innerHTML = '';
          secretPreview.appendChild(img);
        } else {
          secretPreview.innerHTML = '<div style="padding:12px;color:#6b7280">Tidak ada preview untuk file ini</div>';
        }
      } else {
        secretMeta.textContent = '';
        secretPreview.innerHTML = 'Preview secret (jika image)';
      }
    });

    resetBtn.addEventListener('click', resetAll);

    async function fileToUint8(file){
      return new Uint8Array(await file.arrayBuffer());
    }

    async function zipFileToUint8(file){
      if (!window.JSZip) throw new Error('JSZip tidak tersedia (koneksi internet dibutuhkan untuk CDN)');
      const zip = new JSZip();
      zip.file(file.name, await file.arrayBuffer());
      const content = await zip.generateAsync({type:'uint8array'});
      return content;
    }

    mergeBtn.addEventListener('click', async () => {
      statusEl.textContent = '';
      downloadArea.innerHTML = '';

      if (!coverFile){ statusEl.innerHTML = '<span class="danger">Pilih cover terlebih dahulu.</span>'; return; }
      if (!secretFile){ statusEl.innerHTML = '<span class="danger">Pilih file secret terlebih dahulu.</span>'; return; }

      try{
        statusEl.textContent = 'Mempersiapkan file...';

        const coverBuf = await fileToUint8(coverFile);
        let secretBuf;
        if (zipCheckbox.checked){
          statusEl.textContent = 'Mengkompres secret ke ZIP...';
          secretBuf = await zipFileToUint8(secretFile);
        } else {
          secretBuf = await fileToUint8(secretFile);
        }

        // Gabungkan
        statusEl.textContent = 'Menggabungkan file...';
        const merged = new Uint8Array(coverBuf.length + secretBuf.length);
        merged.set(coverBuf, 0);
        merged.set(secretBuf, coverBuf.length);

        const blob = new Blob([merged], { type: coverFile.type || 'application/octet-stream' });
        const url = URL.createObjectURL(blob);

        const suggestedNameBase = (coverFile.name ? coverFile.name.replace(/\.[^.]+$/, '') : 'hidden');
        const secretBase = (secretFile.name ? secretFile.name.replace(/\.[^.]+$/, '') : 'secret');
        const ext = (coverFile.name && coverFile.name.split('.').pop()) || 'png';
        const suggested = `${suggestedNameBase}_with_${secretBase}.${ext}`;

        downloadArea.innerHTML = `<a class="link" id="dl" download="${suggested}" href="${url}">Download hasil (${Math.round(blob.size/1024)} KB)</a>`;

        statusEl.textContent = 'Selesai — file siap diunduh.';
        // hint for extraction
        const hint = document.createElement('div');
        hint.className = 'note';
        hint.innerHTML = 'Hint ekstraksi: jika file secret dikompres menjadi ZIP, ubah ekstensi hasil menjadi .zip lalu buka dengan 7-Zip / ZArchiver.';
        downloadArea.appendChild(hint);

      } catch (err){
        console.error(err);
        statusEl.innerHTML = `<span class="danger">Terjadi kesalahan: ${err.message || err}</span>`;
      }
    });

    // init
    resetAll();
  </script></body>
  </html>
